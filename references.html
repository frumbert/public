<!DOCTYPE html>
<html lang="en-gb" dir="ltr">

	<head>
	   <title>References</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.7/dist/css/uikit.min.css" />
		<script src="https://cdn.jsdelivr.net/npm/uikit@3.5.7/dist/js/uikit.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/uikit@3.5.7/dist/js/uikit-icons.min.js"></script>
		<style>html { background-color: #d9e6f0;} .uk-grid > div { width: 40px; } #content::first-line { font-weight: bold; } .uk-badge { cursor: pointer; background-color: #0055a2; } .uk-badge:hover, .uk-badge:active { background-color: #002f6a; } .selected .uk-badge { box-shadow: 0 0 0 4px white, 0 0 8px black;} </style>
	</head>

	<body class="uk-overflow-auto">
		<div class="uk-section uk-padding-remove-vertical">
			<div class="uk-container uk-container-small">
				<form method="get" class="uk-position-relative">
					<input type="hidden" name="source">
					<fieldset class="uk-fieldset">
						<legend class="uk-legend">References</legend>
						<div id="references" class="uk-grid-small uk-flex-left uk-text-center" uk-grid>
						</div>
						<div id="definition" class="uk-flex uk-flex-between uk-margin-top uk-hidden uk-flex-middle">
							<div id="content"></div>
							<div><a href="#link" target="_blank" class="uk-text-nowrap uk-button uk-button-primary uk-border-rounded uk-button-small">Show</a></div>
						</div>
					</fieldset>
				</form>
			</div>
		</div>
		<script type="text/javascript">
		window.addEventListener('load', function() {
			let db = [];
			const urlParams = new URLSearchParams(window.location.search);
			const source = urlParams.get('source');
			const indexes = urlParams.get('indexes') ? urlParams.get('indexes').split(',').map(n => Number(n) -1) : null;
			const linkLabel = urlParams.get('label') ? urlParams.get('label') : 'Open link';
			const references = document.getElementById('references');
			const definition = document.getElementById('definition');
			const content = document.getElementById('content');
			const link = definition.querySelector("a");
			link.textContent = linkLabel;
			if (null === source) {
				references.removeAttribute("class");
				references.classList.add('uk-alert','uk-alert-danger');
				references.textContent = "Missing configuration file";
				return;
			}
			fetch(source+'.json')
				.then(function(response) {
					return response.json()
				})
				.then(function(json) {
					db = json;
					render();
					references.querySelector("div:first-of-type").click();
				});
			function render() {
				while (references.firstChild) {
				  references.removeChild(references.firstChild);
				}
				db.forEach(function(value,index) {
					if (indexes === null || (indexes.length && indexes.indexOf(index)!==-1)) {
						const div = document.createElement("div");
						const span = document.createElement("span");
						span.classList.add("uk-badge");
						span.textContent = (index+1);
						div.appendChild(span);
						div.dataset.index = index;
						div.title = value.label.split('.')[0];
						div.onclick = show;
						references.appendChild(div);
					}
				})
			}
			function show(e) {
				const me = e.target.closest("div");
				const index = me.dataset.index;
				let row = db[index];
				Array.from(me.parentNode.children).forEach(function(el) {
					el.classList[el===me?"add":"remove"]('selected');
				});
				definition.classList.remove("uk-hidden");
				content.innerHTML = row.label.replace(/\./,'<br>');
				link.href = row.link;
			}
		});
	</script>

</body>
</html>
