<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vimeo Completion Proxy for Storyline</title>
    <style>
    body { margin: 0; background: black; padding: 56.25% 0 0 0; overflow: hidden; min-height: 100vh; }
    iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    </style>
    <script src="https://player.vimeo.com/api/player.js"></script>
</head>
<body>
    
</body>
<script>

    let params = (new URL(document.location)).searchParams;
    let percentage = params.has("required") ? params.get("required") : 0.75;
    let vimeo_id = params.get("id");
    let vimeo_h = params.get("h");    
    let tag = `<iframe src="https://player.vimeo.com/video/${vimeo_id}?h=${vimeo_h}&title=0&byline=0&portrait=0" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;

    // completion percentage in the range of 0-1, but you can pass 0-100
    if (percentage > 1) percentage = percentage / 100;

    // listen to events
    player.on('timeupdate', function(data) {
        if ((_data.seconds / data.duration) >= percentage) {
            if (!completed) {

                // when completed, tell Storyline to set a variable
                // storyline will have to watch the variable change then set the passed/completed for the course
                var player = parent.GetPlayer();
                player.SetVar("completed", true);
                completed = true;
            }
        }
    });

    player.on('play', function() {
      console.log('Played the video');
    });

    player.getVideoTitle().then(function(title) {
        document.title = title;
    });

    // inject the iframe
    document.body.insertAdjacentHTML('beforeend', tag);

</script>
</html>